<!DOCTYPE html>
<html lang="en">
<head>
  <title>Giphy API</title>

  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="assets/css/style.css">
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
  
</head>

<body>


<div class="container">
  <h1>Gifs!</h1>

    <!-- div where buttons will be created -->
    <div id="button-container"></div>

    <form id="input-form">
      <label for="topic-input">Add a Category</label>
      <input type="text" id="topic-input"><br>

      <!-- Button triggers new gifs to appear -->
      <input id="add-button" type="submit" value="Add a Category">
    </form>
	<!-- this is where gifs and ratings will go -->
    <div id="gifs-on-screen"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">

var topics = ["trees", "lake", "mountain", "river", "canyon", "desert", "cactus"];


  function alertGif() {
    alert($(this).attr("data-name"));
  }

      function renderButtons() {
      	$("#button-container").empty();

      	for (i=0; i<topics.length; i++) {
      		var x = $("<button>");
      		x.addClass("topic")
      		.attr("data-name", topics[i])
      		.text(topics[i]);
      		$("#button-container").append(x);
      	}
      }

      $("#add-button").on("click", function(event) {
      	event.preventDefault();
      	var topic = $("#topic-input").val().trim();
      	topics.push(topic);
      	renderButtons();

      })

      renderButtons();

 			function appearGif() {

				var topic = $(this).attr("data-name");
				var queryURL = "https://api.giphy.com/v1/gifs/search?api_key=KgeeIdguXEHsO0CX11g7rQe4H7NdFZ0Q&q=" + topic + "&limit=10&offset=0&lang=en_s.gif";

	     $.ajax({
          url: queryURL,
          method: "GET"
        }).then(function(response) {
         	var results = response.data;
         	for (i=0; i<results.length; i++) {
         		var gifDiv = $("<div class='gif-div'>");

         		var rating = results[i].rating;
         		var p = $("<p>").text("Rating: " + rating);
       
        		var gifImage = $("<img class='gif'>");
 								
          		gifImage.attr("data-state", "still");
          		gifImage.attr("src", results[i].images.fixed_height_still.url);

              gifDiv.prepend(p).prepend(gifImage);
             
 
              $("#gifs-on-screen").prepend(gifDiv);

   	}
         });

    function emptyDiv () {
    	$(".gif-div").empty();
    }

    emptyDiv();
   
    $('body').on('click', '.gif', function() {
    var src = $(this).attr("src");
       if($(this).hasClass('playing')){
    //    //pause
          $(this).attr('src', src.replace(/\.gif/i, "_s.gif"))
          $(this).removeClass('playing');
          console.log("pause");
       } else {
         //play
         $(this).addClass('playing');
         $(this).attr('src', src.replace(/\_s.gif/i, ".gif"))
         console.log("play");
       }
     });

  }


   $(document).on("click", ".topic", appearGif);
   // $(document).on("click", ".gif", animateGif);






</script>

</body>
</html>